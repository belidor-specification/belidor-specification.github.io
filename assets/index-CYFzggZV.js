(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function B(e,t={},a=[]){if(typeof t=="string"&&(t.at(0)==="."?e.classList.add(t.slice(1)):t.at(0)==="#"?e.id=t.slice(1):console.trace("[el] Props is a string but not qualified with a class (.) or id (#).")),typeof t!="string"&&(Object.assign(e,t??{}),"class"in t&&t.class!==void 0&&e.classList.add(...Array.isArray(t.class)?t.class.filter(n=>n!==null):[t.class]),"data"in t&&t.data!==void 0&&t.data.forEach(n=>e.dataset[n[0]]=n[1]),"style"in t&&t.style!==void 0))for(const[n,i]of Object.entries(t.style))e.style[n]=`${i}`;a!==void 0&&e.append(...Array.isArray(a)?a:[a])}function N(e,t={},a=[]){const n=document.createElement(e);return B(n,t,a),n}function T(e,t={},a=[]){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return B(n,t,a),n}function u(e={},t=[]){return N("div",e,t)}function P(e={},t=""){const a=T("path",e);return a.setAttribute("d",t),a}function S(e,t){if(!e)throw new Error("Assertion failed")}function I(e,t,a,n){e.y+=e.height/2-1,e.height=1*2,t.y+=t.height/2-1,t.height=1*2,e.x+=a,t.x+=n;const i=[e.x+e.width,e.y],r=[(e.x+e.width+t.x)/2,e.y],s=[(e.x+e.width+t.x)/2,t.y],o=[t.x,t.y];let p=`M ${i[0]-a} ${i[1]+e.height/2} L ${i[0]} ${i[1]} C ${r[0]} 
${r[1]}, ${s[0]} ${s[1]}, ${o[0]} ${o[1]} L ${o[0]-n} ${o[1]+t.height/2}`;return p+=`L ${o[0]-n} ${o[1]+t.height/2} L ${o[0]} ${o[1]+t.height} C ${s[0]} ${s[1]+t.height}, 
  ${r[0]} ${r[1]+e.height}, ${i[0]} ${i[1]+e.height}
  L ${i[0]-a} ${i[1]+e.height/2}`,p}function k(e){return e.replaceAll("->","__A__").replaceAll(".","__D__").replaceAll("/","__S__").replaceAll("=","__E__")}function F(){return Math.round(Math.random()*1e6).toString()}function E(e){let t=e.split("-").map(a=>a[0].toUpperCase()+a.slice(1)).join(" ");return t.startsWith("Case Study")&&(t=t.slice(11)),t==="Slides Figma"&&(t="Slides"),t==="Cad"&&(t="CAD"),t==="Ipad"&&(t="iPad"),t==="Imessage"&&(t="iMessage"),t}function A(e,t){return`${E(e)} / ${E(t)}`}function K(e,t,a=0){const n=t.map((o,p)=>typeof o[0]=="string"?u({onclick:()=>r(p)},o[0]):(o[0].onclick=()=>r(p),o[0])),i=u(".tabs-toggles",n),r=o=>{const p=[...n];t[o][1].classList.add("active"),t.filter((h,y)=>y!==o).forEach(h=>h[1].classList.remove("active")),p[o].classList.add("active"),p.filter((h,y)=>y!==o).forEach(h=>h.classList.remove("active"))};r(a);const s=u(e,[i,u(".tabs-panes",t.map(o=>o[1]))]);return s.classList.add("tabs"),s.addEventListener("switch-tab",o=>{S("detail"in o),r(o.detail)}),s}function Y(e,t,a=0,n=""){const i=K(e,t,a);return i.classList.add("vtabs"),n.length>0&&i.children[0].prepend(u(".vtabs-header",n)),i}function H(e,t,a,n=0){const i=[];for(let s=0;s<a.length-1;s++)i.push(a[s]);a.length>0&&i.push(a.at(-1));const r=u(t,i);return r.classList.add("stack",e==="horizontal"?"hstack":"vstack"),r.style.gap=`${n}px`,r}function G(e,t,a=0){return H("horizontal",e,t,a)}function R(e,t,a=0){return H("vertical",e,t,a)}async function D(e){const t={frag:u(".viewer"),spec:e,view:void 0};return await j(t),t}async function j(e){e.frag.innerHTML="",e.view=q(e.spec.yaml,[]);const t=await Q(e);e.frag.append(t),e.frag.append(u(".viewer-yaml",e.view.frag))}async function Q(e){const t=await(await fetch(`./annotations/${e.spec.name}.svg`)).text(),a=u({class:"viewer-ui",innerHTML:t}),n=a.children[0];if(n.setAttribute("preserveAspectRatio","xMinYMin meet"),n.removeAttribute("width"),n.removeAttribute("height"),n.children.length>0){[...n.children[0].children].forEach(s=>{typeof s.id=="string"&&(s.id=k(s.id))});const i=F();[...n.querySelectorAll("pattern"),...n.querySelectorAll("filter"),...n.querySelectorAll("linearGradient")].forEach(s=>s.id=`${s.id}_ID${i}`);const r=[...n.querySelectorAll("rect"),...n.querySelectorAll("path"),...n.querySelectorAll("g")];["fill","stroke","filter"].forEach(s=>{r.forEach(o=>{const p=o.getAttribute(s);p!==null&&p.startsWith("url(#")&&o.setAttribute(s,`url(#${p.slice(5,-1)}_ID${i})`)})})}return a}function q(e,t){if(typeof e=="object"&&!Array.isArray(e))return V(e,t);if(typeof e=="object"&&Array.isArray(e))return X(e,t);if(typeof e=="string")return J(e,t);throw new Error("[render] Unknown object typ")}function V(e,t){const a=Object.keys(e).map(i=>J(i,[...t,["__KEY",i]],!0)),n=Object.entries(e).map(([i,r])=>q(r,[...t,i]));return{type:"Object",frag:R(".v-obj",Object.entries(e).map((i,r)=>{const s=["v-obj-entry"];return n[r].type==="Primitive"&&s.push("is-single-line"),u({class:s},[u(".v-obj-key",a[r].frag),u(".v-obj-value",n[r].frag)])})),path:t,keys:a,values:n}}function X(e,t){let a=["v-array"];e.length===3&&["subset>","cover>","affects>"].includes(e[1])&&a.push("v-relation-array");const n=e.map((i,r)=>q(i,[...t,r]));return{type:"Array",frag:R({class:a},e.map((i,r)=>u(".v-array-entry",n[r].frag))),path:t,items:n}}function J(e,t,a=!1){let n;const i=["v-string"];if(a&&i.push("v-key"),["affects","cover","cover>","group","subset","subset>","<>","create","delete","update","directions","group foreach"].includes(e)&&(i.push("v-relation"),e.at(-1)!==">"&&(e+=">")),e.startsWith("(")){const r=e.indexOf(")",1),s=e.slice(0,r+1),o=e.slice(r+1);n=u({class:i},[u(".v-string-type",s),o])}else n=u({class:i},e);return{type:"Primitive",frag:n,path:t,value:e}}function _(e,t){if(t(e))return e;if(e.type==="Array")for(const a of e.items){const n=_(a,t);if(n!==void 0)return n}if(e.type==="Object"){for(const a of e.keys){const n=_(a,t);if(n!==void 0)return n}for(const a of e.values){const n=_(a,t);if(n!==void 0)return n}}}async function U(e,t,a){const n=await D(e),i=await D(t),r={frag:G(".analogy-viewer",[u(".header-preamble",[N("h1",{},"Structural Analogies of User Interfaces with Belidor"),u({innerHTML:`Belidor is a specification language for user interfaces to help surface analogies between them.
        Below are interactive displays of various analogies described in the paper. 
        <br><br>
        Usage instructions:
        <ol>
          <li>Hover over a part of a specification to highlight the match across both interfaces.</li>
          <li>Click on a part of a specification to pin it.</li>
          <li>Navigate between case-study analogies using the navigation list. Navigate between computed analogies by clicking on a cell in the cost-matrix.</li>
        </ol>`})]),u(".analogy-title",[u({},E(e.name)),u(".ampersand","&"),u({},E(t.name))]),u(".analogy-viewer-viewers",[n.frag,i.frag,T("svg",".overlay")])]),a:e,b:t,a_viewer:n,b_viewer:i,analogy:a,num_pinned:0,num_highlighted:0};return await Z(r,e,t),r}async function Z(e,t,a){const{a_viewer:n,b_viewer:i}=e;e.a=t,e.b=a,n.spec=t,i.spec=a,await j(n),await j(i),setTimeout(()=>ee(e),1e3)}function ee(e){const{a:t,b:a,a_viewer:n,b_viewer:i,analogy:r}=e,s=e.frag.querySelector(".overlay");s.innerHTML="";const o=e.frag.getBoundingClientRect(),p=n.frag.getBoundingClientRect(),h=i.frag.getBoundingClientRect();for(const[y,d]of Object.entries(r.analogy[0])){if(d[1]===!0)continue;const w=d[0],m=t.lookup.filter(l=>l[0]===y).map(l=>l[1]),f=a.lookup.filter(l=>l[0]===w).map(l=>l[1]);S(n.view!==void 0),S(i.view!==void 0);const L=m.map(l=>_(n.view,$=>JSON.stringify($.path)===JSON.stringify(l))).filter(l=>l!==void 0),v=f.map(l=>_(i.view,$=>JSON.stringify($.path)===JSON.stringify(l))).filter(l=>l!==void 0),c=n.frag.querySelector(`#${k(y)}`),b=i.frag.querySelector(`#${k(w)}`),g=L.map(l=>l.frag.getBoundingClientRect()).map(l=>(l.x-=o.x,l.y-=o.y,l)),z=v.map(l=>l.frag.getBoundingClientRect()).map(l=>(l.x-=o.x,l.y-=o.y,l)),O={x:(p.right+h.left)/2-o.x,y:g.reduce((l,$)=>l+$.y+$.height/2,0)/g.length,width:1,height:1},C=g.map(l=>P(".connection-path",I(l,O,p.right-l.right-o.x,0))),M=z.map(l=>P(".connection-path",I(O,l,0,h.left-l.left-o.x)));te(v,L,M,C,b,c,e),s.append(...C),s.append(...M)}}const x=[0,45,180,-90,135,90];function te(e,t,a,n,i,r,s){const o=e.map(m=>m.frag),p=t.map(m=>m.frag),h=[...o,...p];h.forEach(m=>m.classList.add("matched"));let y=!1,d=[...h,...a,...n,i,r].filter(m=>m!==null),w=()=>{s.num_highlighted>0||s.num_pinned>0?s.frag.classList.add("focused"):s.frag.classList.remove("focused")};h.forEach(m=>{m.addEventListener("mouseenter",()=>{if(d.some(v=>v.classList.contains("pinned")))return;d.forEach(v=>v.classList.add("highlight"));const f=s.num_pinned%x.length,L=x[f];d.forEach(v=>v.style.filter=`hue-rotate(${L}deg)`),s.num_highlighted++,w()}),m.addEventListener("mouseleave",()=>{d.some(f=>f.classList.contains("pinned"))||(d.forEach(f=>f.classList.remove("highlight")),d.forEach(f=>f.style.filter=""),s.num_highlighted--,w())}),m.addEventListener("mousedown",()=>{if(y)y=!1,d.forEach(f=>f.classList.remove("pinned")),d.forEach(f=>f.style.filter=""),s.num_pinned--;else{const f=s.num_pinned%x.length,L=x[f];y=!0,d.forEach(v=>v.classList.add("pinned")),d.forEach(v=>v.style.filter=`hue-rotate(${L}deg)`),s.num_pinned++}w()})})}function ne(e){const t={frag:u(".cost-matrix"),analogies:e};return ie(t),t}function ie(e){const t=e.analogies,a=[...new Set(t.flatMap(i=>i.inputs))];e.frag.innerHTML="";const n=a.map((i,r)=>u({class:"cost-matrix-row",style:{}},[...a.map((s,o)=>{const p=[...o===0?[u(".cost-matrix-row-label",E(i))]:[],...r===0?[u(".cost-matrix-col-label",E(s))]:[]],h=t.find(f=>f.inputs[0]===i&&f.inputs[1]===s||f.inputs[1]===i&&f.inputs[0]===s),y=h==null?void 0:h.score;let d="none";const w=["cost-matrix-item"];h!==void 0&&h.num_iterations<=3&&w.push("insignificant"),y!==void 0&&(d=`oklab(${.5} ${.1} ${-.2} / ${y*.9})`);const m=`${y!==void 0?y:"-"} (${i}, ${s})`;return u({class:w,title:m,style:{background:d},data:[["name",A(i,s)],["alt_name",A(s,i)]]},p)})]));e.frag.append(...n)}async function ae(){const e=await(await fetch("./specs.json")).json(),t=await(await fetch("./case-study-specs.json")).json(),a=await(await fetch("./analogies.json")).json(),n=await(await fetch("./case-study-analogies.json")).json(),i=c=>({name:c,yaml:e[c].yaml,lookup:e[c].lookup}),r=c=>({name:c,yaml:t[c].yaml,lookup:t[c].lookup}),s=await Promise.all(a.map(c=>U(i(c.inputs[0]),i(c.inputs[1]),a.find(b=>b.inputs.includes(c.inputs[0])&&b.inputs.includes(c.inputs[1]))))),o=await Promise.all(n.map(c=>U(r(c.inputs[0]),r(c.inputs[1]),n.find(b=>b.inputs.includes(c.inputs[0])&&b.inputs.includes(c.inputs[1]))))),p=ne(a),h=s.map(c=>[A(c.a.name,c.b.name),c.frag]),y=o.map(c=>[u(".case-study-tab-label",A(c.a.name,c.b.name)),c.frag]),d=Y(".app-tabs",[...y,...h]),w=[...d.querySelectorAll(".tabs-toggles > *:not(.cost-matrix):not(.case-study-label-container):not(.section-label)")],m=[...d.querySelectorAll(".tabs-toggles > *.case-study-tab-label")],f=[...p.frag.querySelectorAll(".cost-matrix-item")],L=[...p.frag.querySelectorAll(".cost-matrix-row-label"),...p.frag.querySelectorAll(".cost-matrix-col-label")];f.forEach(c=>{const b=w.findIndex(g=>g.innerText===c.dataset.name||g.innerText===c.dataset.alt_name);b!==-1&&c.addEventListener("click",()=>{d.dispatchEvent(new CustomEvent("switch-tab",{detail:b})),f.forEach(g=>g.classList.remove("active")),L.forEach(g=>g.classList.remove("active")),L.filter(g=>g.innerText===c.dataset.name.split(" / ")[0]||g.innerText===c.dataset.name.split(" / ")[1]).forEach(g=>{g.classList.add("active")}),f.filter(g=>g.dataset.name===c.dataset.name||g.dataset.alt_name===c.dataset.name).forEach(g=>g.classList.add("active"))})}),m.forEach(c=>{c.addEventListener("click",()=>{f.forEach(b=>b.classList.remove("active")),L.forEach(b=>b.classList.remove("active"))})});const v=u(".case-study-label-container",m);d.children[0].prepend(v),document.getElementById("app").append(d),d.children[0].append(p.frag),d.children[0].prepend(u(".section-label","Case studies")),d.children[0].insertBefore(u(".section-label","Computed analogies"),d.children[0].children[5])}async function W(){requestAnimationFrame(W)}ae(),W();
