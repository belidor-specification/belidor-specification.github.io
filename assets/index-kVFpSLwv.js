(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function N(e,t={},a=[]){if(typeof t=="string"&&(t.at(0)==="."?e.classList.add(t.slice(1)):t.at(0)==="#"?e.id=t.slice(1):console.trace("[el] Props is a string but not qualified with a class (.) or id (#).")),typeof t!="string"&&(Object.assign(e,t??{}),"class"in t&&t.class!==void 0&&e.classList.add(...Array.isArray(t.class)?t.class.filter(n=>n!==null):[t.class]),"data"in t&&t.data!==void 0&&t.data.forEach(n=>e.dataset[n[0]]=n[1]),"style"in t&&t.style!==void 0))for(const[n,i]of Object.entries(t.style))e.style[n]=`${i}`;a!==void 0&&e.append(...Array.isArray(a)?a:[a])}function b(e,t={},a=[]){const n=document.createElement(e);return N(n,t,a),n}function P(e,t={},a=[]){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return N(n,t,a),n}function f(e={},t=[]){return b("div",e,t)}function F(e={},t=[]){return b("pre",e,t)}function B(e={},t=""){const a=P("path",e);return a.setAttribute("d",t),a}function A(e,t){if(!e)throw new Error("Assertion failed")}function R(e,t,a,n){e.y+=e.height/2-1,e.height=1*2,t.y+=t.height/2-1,t.height=1*2,e.x+=a,t.x+=n;const i=[e.x+e.width,e.y],r=[(e.x+e.width+t.x)/2,e.y],s=[(e.x+e.width+t.x)/2,t.y],o=[t.x,t.y];let d=`M ${i[0]-a} ${i[1]+e.height/2} L ${i[0]} ${i[1]} C ${r[0]} 
${r[1]}, ${s[0]} ${s[1]}, ${o[0]} ${o[1]} L ${o[0]-n} ${o[1]+t.height/2}`;return d+=`L ${o[0]-n} ${o[1]+t.height/2} L ${o[0]} ${o[1]+t.height} C ${s[0]} ${s[1]+t.height}, 
  ${r[0]} ${r[1]+e.height}, ${i[0]} ${i[1]+e.height}
  L ${i[0]-a} ${i[1]+e.height/2}`,d}function k(e){return e.replaceAll("->","__A__").replaceAll(".","__D__").replaceAll("/","__S__").replaceAll("=","__E__")}function H(){return Math.round(Math.random()*1e6).toString()}function _(e){let t=e.split("-").map(a=>a[0].toUpperCase()+a.slice(1)).join(" ");return e==="imessage"?"iMessage":t}function $(e,t){return`${_(e)} / ${_(t)}`}function G(e,t,a=0){const n=t.map((o,d)=>f({onclick:()=>r(d)},o[0])),i=f(".tabs-toggles",n),r=o=>{const d=[...n];t[o][1].classList.add("active"),t.filter((h,c)=>c!==o).forEach(h=>h[1].classList.remove("active")),d[o].classList.add("active"),d.filter((h,c)=>c!==o).forEach(h=>h.classList.remove("active"))};r(a);const s=f(e,[i,f(".tabs-panes",t.map(o=>o[1]))]);return s.classList.add("tabs"),s.addEventListener("switch-tab",o=>{A("detail"in o),r(o.detail)}),s}function Q(e,t,a=0,n=""){const i=G(e,t,a);return i.classList.add("vtabs"),n.length>0&&i.children[0].prepend(f(".vtabs-header",n)),i}function J(e,t,a,n=0){const i=[];for(let s=0;s<a.length-1;s++)i.push(a[s]);a.length>0&&i.push(a.at(-1));const r=f(t,i);return r.classList.add("stack",e==="horizontal"?"hstack":"vstack"),r.style.gap=`${n}px`,r}function S(e,t,a=0){return J("horizontal",e,t,a)}function I(e,t,a=0){return J("vertical",e,t,a)}function j(e={},t,a,n=!1){const i=H(),r=b("input",".checkbox-input"),s=b("label",".checkbox-label",t);r.id=i,r.setAttribute("type","checkbox"),s.setAttribute("for",i),r.checked=n,n&&(a==null||a(r.checked,r)),r.addEventListener("change",d=>{a==null||a(r.checked,d.target)});const o=S(e,[r,s]);return o.classList.add("checkbox"),o}async function z(e){const t={frag:f(".viewer"),spec:e,view:void 0};return await O(t),t}async function O(e){e.frag.innerHTML="",e.view=M(e.spec.yaml,[]);const t=await V(e);e.frag.append(t),e.frag.append(f(".viewer-yaml",e.view.frag))}async function V(e){const t=await(await fetch(`./annotations/${e.spec.name}.svg`)).text(),a=f({class:"viewer-ui",innerHTML:t}),n=a.children[0];if(n.setAttribute("preserveAspectRatio","xMinYMin meet"),n.removeAttribute("width"),n.removeAttribute("height"),n.children.length>0){[...n.children[0].children].forEach(r=>{typeof r.id=="string"&&(r.id=k(r.id))});const i=H();[...n.querySelectorAll("pattern")].forEach(r=>r.id=`${r.id}_${i}`),[...n.querySelectorAll("rect")].forEach(r=>{const s=r.getAttribute("fill");s!==null&&s.startsWith("url(#")&&r.setAttribute("fill",`url(#${s.slice(5,-1)}_${i})`)})}return a}function M(e,t){if(typeof e=="object"&&!Array.isArray(e))return X(e,t);if(typeof e=="object"&&Array.isArray(e))return Z(e,t);if(typeof e=="string")return K(e,t);throw new Error("[render] Unknown object typ")}function X(e,t){const a=Object.keys(e).map(i=>K(i,[...t,["__KEY",i]],!0)),n=Object.entries(e).map(([i,r])=>M(r,[...t,i]));return{type:"Object",frag:I(".v-obj",Object.entries(e).map((i,r)=>{const s=["v-obj-entry"];return n[r].type==="Primitive"&&s.push("is-single-line"),f({class:s},[f(".v-obj-key",a[r].frag),f(".v-obj-value",n[r].frag)])})),path:t,keys:a,values:n}}function Z(e,t){const a=e.map((n,i)=>M(n,[...t,i]));return{type:"Array",frag:I(".v-array",e.map((n,i)=>f(".v-array-entry",a[i].frag))),path:t,items:a}}function K(e,t,a=!1){let n;const i=["v-string"];if(a&&i.push("v-key"),e.startsWith("(")){const r=e.indexOf(")",1),s=e.slice(0,r+1),o=e.slice(r+1);n=f({class:i},[f(".v-string-type",s),o])}else n=f({class:i},e);return{type:"Primitive",frag:n,path:t,value:e}}function L(e,t){if(t(e))return e;if(e.type==="Array")for(const a of e.items){const n=L(a,t);if(n!==void 0)return n}if(e.type==="Object"){for(const a of e.keys){const n=L(a,t);if(n!==void 0)return n}for(const a of e.values){const n=L(a,t);if(n!==void 0)return n}}}async function ee(e,t,a){const n=await z(e),i=await z(t),r={frag:S(".analogy-viewer",[b("p",".analogy-title",$(e.name,t.name)),F(".analogy-info",a.stdout.join(`
`)),f(".analogy-viewer-viewers",[n.frag,i.frag,P("svg",".overlay")])]),a:e,b:t,a_viewer:n,b_viewer:i,analogy:a,num_pinned:0,num_highlighted:0};return await te(r,e,t),r}async function te(e,t,a){const{a_viewer:n,b_viewer:i}=e;e.a=t,e.b=a,n.spec=t,i.spec=a,await O(n),await O(i),setTimeout(()=>ne(e),1e3)}function ne(e){const{a:t,b:a,a_viewer:n,b_viewer:i,analogy:r}=e,s=e.frag.querySelector(".overlay");s.innerHTML="";const o=e.frag.getBoundingClientRect(),d=n.frag.getBoundingClientRect(),h=i.frag.getBoundingClientRect();for(const[c,u]of Object.entries(r.analogy[0])){if(u[1]===!0)continue;const p=u[0],m=t.lookup.filter(l=>l[0]===c).map(l=>l[1]),g=a.lookup.filter(l=>l[0]===p).map(l=>l[1]);A(n.view!==void 0),A(i.view!==void 0);const v=m.map(l=>L(n.view,w=>JSON.stringify(w.path)===JSON.stringify(l))).filter(l=>l!==void 0),y=g.map(l=>L(i.view,w=>JSON.stringify(w.path)===JSON.stringify(l))).filter(l=>l!==void 0),W=n.frag.querySelector(`#${k(c)}`),Y=i.frag.querySelector(`#${k(p)}`),E=v.map(l=>l.frag.getBoundingClientRect()).map(l=>(l.x-=o.x,l.y-=o.y,l)),D=y.map(l=>l.frag.getBoundingClientRect()).map(l=>(l.x-=o.x,l.y-=o.y,l)),q={x:(d.right+h.left)/2-o.x,y:E.reduce((l,w)=>l+w.y+w.height/2,0)/E.length,width:1,height:1},C=E.map(l=>B(".connection-path",R(l,q,d.right-l.right-o.x,0))),T=D.map(l=>B(".connection-path",R(q,l,0,h.left-l.left-o.x)));ie(y,v,T,C,Y,W,e),s.append(...C),s.append(...T)}}const x=[0,180,45,135,90];function ie(e,t,a,n,i,r,s){const o=e.map(m=>m.frag),d=t.map(m=>m.frag),h=[...o,...d];h.forEach(m=>m.classList.add("matched"));let c=!1,u=[...h,...a,...n,i,r].filter(m=>m!==null),p=()=>{s.num_highlighted>0||s.num_pinned>0?s.frag.classList.add("focused"):s.frag.classList.remove("focused")};h.forEach(m=>{m.addEventListener("mouseenter",()=>{if(u.some(y=>y.classList.contains("pinned")))return;u.forEach(y=>y.classList.add("highlight"));const g=s.num_pinned%x.length,v=x[g];u.forEach(y=>y.style.filter=`hue-rotate(${v}deg)`),s.num_highlighted++,p()}),m.addEventListener("mouseleave",()=>{u.some(g=>g.classList.contains("pinned"))||(u.forEach(g=>g.classList.remove("highlight")),u.forEach(g=>g.style.filter=""),s.num_highlighted--,p())}),m.addEventListener("mousedown",()=>{if(c)c=!1,u.forEach(g=>g.classList.remove("pinned")),u.forEach(g=>g.style.filter=""),s.num_pinned--;else{const g=s.num_pinned%x.length,v=x[g];c=!0,u.forEach(y=>y.classList.add("pinned")),u.forEach(y=>y.style.filter=`hue-rotate(${v}deg)`),s.num_pinned++}p()})})}function ae(e){const t={frag:f(".cost-matrix"),analogies:e};return re(t),t}function re(e){const t=e.analogies,a=[...new Set(t.flatMap(i=>i.inputs))];e.frag.innerHTML="",t.reduce((i,r)=>Math.min(i,r.conceptual_connectivity),1/0),t.reduce((i,r)=>Math.max(i,r.conceptual_connectivity),0);const n=a.map((i,r)=>f({class:"cost-matrix-row",style:{}},[...a.map((s,o)=>{const d=[...o===0?[f(".cost-matrix-row-label",_(i))]:[],...r===0?[f(".cost-matrix-col-label",_(s))]:[]],h=t.find(g=>g.inputs[0]===i&&g.inputs[1]===s||g.inputs[1]===i&&g.inputs[0]===s),c=h==null?void 0:h.score;let u="none";const p=["cost-matrix-item"];h!==void 0&&h.num_iterations<=3&&p.push("insignificant"),c!==void 0&&(u=`oklab(${.5} ${.1} ${-.2} / ${c*.9})`);const m=`${c!==void 0?c:"-"} (${i}, ${s})`;return f({class:p,title:m,style:{background:u},data:[["name",$(i,s)],["alt_name",$(s,i)]]},d)})]));e.frag.append(...n)}async function se(){const e=await(await fetch("./specs.json")).json(),t=await(await fetch("./analogies.json")).json(),a=c=>({name:c,yaml:e[c].yaml,lookup:e[c].lookup}),n=await Promise.all(t.map(c=>ee(a(c.inputs[0]),a(c.inputs[1]),t.find(u=>u.inputs.includes(c.inputs[0])&&u.inputs.includes(c.inputs[1]))))),i=ae(t),r=Q(".app-tabs",n.map(c=>[$(c.a.name,c.b.name),c.frag])),s=[...r.querySelectorAll(".tabs-toggles > *:not(.cost-matrix)")],o=[...i.frag.querySelectorAll(".cost-matrix-item")];o.forEach(c=>{const u=s.findIndex(p=>p.innerText===c.dataset.name||p.innerText===c.dataset.alt_name);u!==-1&&c.addEventListener("click",()=>{r.dispatchEvent(new CustomEvent("switch-tab",{detail:u})),o.forEach(p=>p.classList.remove("active")),o.filter(p=>p.dataset.name===c.dataset.name||p.dataset.alt_name===c.dataset.name).forEach(p=>p.classList.add("active"))})}),o.filter(c=>c.dataset.name===s[0].innerText||c.dataset.alt_name===s[0].innerText).forEach(c=>c.classList.add("active"));const d=document.getElementById("app");d.append(r),document.querySelector(".tabs-toggles").prepend(i.frag);const h=S(".analogy-viewer-options",[j({},"Show syntax highlighting",()=>{d.classList.toggle("show-syntax-highlighting")}),j({},"Show primitives inline",()=>{d.classList.toggle("show-primitives-inline")}),j({},"Show cost matrix",c=>{const u=document.querySelector(".cost-matrix");u!==null&&(c?u.classList.add("visible"):u.classList.remove("visible"))},!0)],10);document.querySelector("header").append(h)}async function U(){requestAnimationFrame(U)}se(),U();
