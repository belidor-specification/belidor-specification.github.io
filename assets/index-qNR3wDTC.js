(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function I(e,t={},a=[]){if(typeof t=="string"&&(t.at(0)==="."?e.classList.add(t.slice(1)):t.at(0)==="#"?e.id=t.slice(1):console.trace("[el] Props is a string but not qualified with a class (.) or id (#).")),typeof t!="string"&&(Object.assign(e,t??{}),"class"in t&&t.class!==void 0&&e.classList.add(...Array.isArray(t.class)?t.class.filter(n=>n!==null):[t.class]),"data"in t&&t.data!==void 0&&t.data.forEach(n=>e.dataset[n[0]]=n[1]),"style"in t&&t.style!==void 0))for(const[n,i]of Object.entries(t.style))e.style[n]=`${i}`;a!==void 0&&e.append(...Array.isArray(a)?a:[a])}function P(e,t={},a=[]){const n=document.createElement(e);return I(n,t,a),n}function H(e,t={},a=[]){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return I(n,t,a),n}function f(e={},t=[]){return P("div",e,t)}function R(e={},t=""){const a=H("path",e);return a.setAttribute("d",t),a}function q(e,t){if(!e)throw new Error("Assertion failed")}function D(e,t,a,n){e.y+=e.height/2-1,e.height=1*2,t.y+=t.height/2-1,t.height=1*2,e.x+=a,t.x+=n;const i=[e.x+e.width,e.y],c=[(e.x+e.width+t.x)/2,e.y],s=[(e.x+e.width+t.x)/2,t.y],r=[t.x,t.y];let g=`M ${i[0]-a} ${i[1]+e.height/2} L ${i[0]} ${i[1]} C ${c[0]} 
${c[1]}, ${s[0]} ${s[1]}, ${r[0]} ${r[1]} L ${r[0]-n} ${r[1]+t.height/2}`;return g+=`L ${r[0]-n} ${r[1]+t.height/2} L ${r[0]} ${r[1]+t.height} C ${s[0]} ${s[1]+t.height}, 
  ${c[0]} ${c[1]+e.height}, ${i[0]} ${i[1]+e.height}
  L ${i[0]-a} ${i[1]+e.height/2}`,g}function O(e){return e.replaceAll("->","__A__").replaceAll(".","__D__").replaceAll("/","__S__").replaceAll("=","__E__")}function Y(){return Math.round(Math.random()*1e6).toString()}function A(e){let t=e.split("-").map(a=>a[0].toUpperCase()+a.slice(1)).join(" ");return t.startsWith("Case Study")&&(t=t.slice(11)),t==="Slides Figma"&&(t="Slides"),t==="Cad"&&(t="CAD"),t==="Ipad"&&(t="iPad"),t==="Imessage"&&(t="iMessage"),t}function T(e,t){return`${A(e)} / ${A(t)}`}function F(e,t,a=0){const n=t.map((r,g)=>typeof r[0]=="string"?f({onclick:()=>c(g)},r[0]):(r[0].onclick=()=>c(g),r[0])),i=f(".tabs-toggles",n),c=r=>{const g=[...n];t[r][1].classList.add("active"),t.filter((d,m)=>m!==r).forEach(d=>d[1].classList.remove("active")),g[r].classList.add("active"),g.filter((d,m)=>m!==r).forEach(d=>d.classList.remove("active"))};c(a);const s=f(e,[i,f(".tabs-panes",t.map(r=>r[1]))]);return s.classList.add("tabs"),s.addEventListener("switch-tab",r=>{q("detail"in r),c(r.detail)}),s}function G(e,t,a=0,n=""){const i=F(e,t,a);return i.classList.add("vtabs"),n.length>0&&i.children[0].prepend(f(".vtabs-header",n)),i}function J(e,t,a,n=0){const i=[];for(let s=0;s<a.length-1;s++)i.push(a[s]);a.length>0&&i.push(a.at(-1));const c=f(t,i);return c.classList.add("stack",e==="horizontal"?"hstack":"vstack"),c.style.gap=`${n}px`,c}function Q(e,t,a=0){return J("horizontal",e,t,a)}function U(e,t,a=0){return J("vertical",e,t,a)}const C={};async function W(e){const t={frag:f(".viewer"),spec:e,view:void 0};return await M(t),t}async function M(e){e.frag.innerHTML="",e.view=B(e.spec.yaml,[]);const t=await V(e);e.frag.append(t),e.frag.append(f(".viewer-yaml",e.view.frag))}async function V(e){const t=`./annotations/${e.spec.name}.svg`;let a;t in C?a=C[t]:(a=await(await fetch(t)).text(),C[t]=a);const n=f({class:"viewer-ui",innerHTML:a}),i=n.children[0];if(i.setAttribute("preserveAspectRatio","xMinYMin meet"),i.removeAttribute("width"),i.removeAttribute("height"),i.children.length>0){[...i.children[0].children].forEach(r=>{typeof r.id=="string"&&(r.id=O(r.id))});const c=Y();[...i.querySelectorAll("pattern"),...i.querySelectorAll("filter"),...i.querySelectorAll("linearGradient")].forEach(r=>r.id=`${r.id}_ID${c}`);const s=[...i.querySelectorAll("rect"),...i.querySelectorAll("path"),...i.querySelectorAll("g")];["fill","stroke","filter"].forEach(r=>{s.forEach(g=>{const d=g.getAttribute(r);d!==null&&d.startsWith("url(#")&&g.setAttribute(r,`url(#${d.slice(5,-1)}_ID${c})`)})})}return n}function B(e,t){if(typeof e=="object"&&!Array.isArray(e))return X(e,t);if(typeof e=="object"&&Array.isArray(e))return Z(e,t);if(typeof e=="string")return z(e,t);throw new Error("[render] Unknown object typ")}function X(e,t){const a=Object.keys(e).map(i=>z(i,[...t,["__KEY",i]],!0)),n=Object.entries(e).map(([i,c])=>B(c,[...t,i]));return{type:"Object",frag:U(".v-obj",Object.entries(e).map((i,c)=>{const s=["v-obj-entry"];return n[c].type==="Primitive"&&s.push("is-single-line"),f({class:s},[f(".v-obj-key",a[c].frag),f(".v-obj-value",n[c].frag)])})),path:t,keys:a,values:n}}function Z(e,t){let a=["v-array"];e.length===3&&["subset>","cover>","affects>"].includes(e[1])&&a.push("v-relation-array");const n=e.map((i,c)=>B(i,[...t,c]));return{type:"Array",frag:U({class:a},e.map((i,c)=>f(".v-array-entry",n[c].frag))),path:t,items:n}}function z(e,t,a=!1){let n;const i=["v-string"];if(a&&i.push("v-key"),["affects","cover","cover>","group","subset","subset>","<>","create","delete","update","directions","group foreach"].includes(e)&&(i.push("v-relation"),e.at(-1)!==">"&&(e+=">")),e.startsWith("(")){const c=e.indexOf(")",1),s=e.slice(0,c+1),r=e.slice(c+1);n=f({class:i},[f(".v-string-type",s),r])}else n=f({class:i},e);return{type:"Primitive",frag:n,path:t,value:e}}function k(e,t){if(t(e))return e;if(e.type==="Array")for(const a of e.items){const n=k(a,t);if(n!==void 0)return n}if(e.type==="Object"){for(const a of e.keys){const n=k(a,t);if(n!==void 0)return n}for(const a of e.values){const n=k(a,t);if(n!==void 0)return n}}}async function K(e,t,a){const n=await W(e),i=await W(t),c={frag:Q(".analogy-viewer",[f(".header-preamble",[P("h1",{},"Structural Analogies of User Interfaces with Belidor"),f({innerHTML:`Belidor is a specification language for describing user interfaces and help surface analogies between them. Below are interactive displays of various analogies described in the paper.
        <br><br>
        Instructions:
        <ol>
          <li>Hover over an identifier in a specification to highlight the match across both interfaces.</li>
          <li>Click on an identifier in the specification to pin it.</li>
          <li>Navigate between case studies using the navigation list on the left. Navigate between computed analogies by clicking on a cell in the heat map.</li>
        </ol>`})]),f(".analogy-title",[f({},A(e.name)),f(".ampersand","&"),f({},A(t.name))]),f(".analogy-viewer-viewers",[n.frag,i.frag,H("svg",".overlay")])]),a:e,b:t,a_viewer:n,b_viewer:i,analogy:a,num_pinned:0,num_highlighted:0};return await ee(c,e,t),c}async function ee(e,t,a){const{a_viewer:n,b_viewer:i}=e;e.a=t,e.b=a,n.spec=t,i.spec=a,await M(n),await M(i),setTimeout(()=>te(e),1e3)}function te(e){const{a:t,b:a,a_viewer:n,b_viewer:i,analogy:c}=e,s=e.frag.querySelector(".overlay");s.innerHTML="";const r=e.frag.getBoundingClientRect(),g=n.frag.getBoundingClientRect(),d=i.frag.getBoundingClientRect();for(const[m,p]of Object.entries(c.analogy[0])){if(p[1]===!0)continue;const x=p[0],y=t.lookup.filter(o=>o[0]===m).map(o=>o[1]),w=a.lookup.filter(o=>o[0]===x).map(o=>o[1]);q(n.view!==void 0),q(i.view!==void 0);const L=y.map(o=>k(n.view,_=>JSON.stringify(_.path)===JSON.stringify(o))).filter(o=>o!==void 0),$=w.map(o=>k(i.view,_=>JSON.stringify(_.path)===JSON.stringify(o))).filter(o=>o!==void 0),l=n.frag.querySelector(`#${O(m)}`),v=i.frag.querySelector(`#${O(x)}`),h=L.map(o=>o.frag.getBoundingClientRect()).map(o=>(o.x-=r.x,o.y-=r.y,o)),S=$.map(o=>o.frag.getBoundingClientRect()).map(o=>(o.x-=r.x,o.y-=r.y,o)),u={x:(g.right+d.left)/2-r.x,y:h.reduce((o,_)=>o+_.y+_.height/2,0)/h.length,width:1,height:1},b=h.map(o=>R(".connection-path",D(o,u,g.right-o.right-r.x,0))),E=S.map(o=>R(".connection-path",D(u,o,0,d.left-o.left-r.x)));ie($,L,E,b,v,l,e),s.append(...b),s.append(...E)}}const j=[0,45,180,-90,135,90];function ie(e,t,a,n,i,c,s){var y,w,L,$,l,v,h,S;const r=e.map(u=>u.frag),g=t.map(u=>u.frag),d=[...r,...g];d.forEach(u=>u.classList.add("matched"));let m=!1,p=[...d,...a,...n,i,c].filter(u=>u!==null),x=()=>{s.num_highlighted>0||s.num_pinned>0?s.frag.classList.add("focused"):s.frag.classList.remove("focused")};d.forEach(u=>{u.addEventListener("mouseenter",()=>{if(p.some(o=>o.classList.contains("pinned")))return;p.forEach(o=>o.classList.add("highlight"));const b=s.num_pinned%j.length,E=j[b];p.forEach(o=>o.style.filter=`hue-rotate(${E}deg)`),s.num_highlighted++,x()}),u.addEventListener("mouseleave",()=>{p.some(b=>b.classList.contains("pinned"))||(p.forEach(b=>b.classList.remove("highlight")),p.forEach(b=>b.style.filter=""),s.num_highlighted--,x())}),u.addEventListener("click",()=>{if(m)m=!1,p.forEach(b=>b.classList.remove("pinned")),p.forEach(b=>b.style.filter=""),s.num_pinned--;else{const b=s.num_pinned%j.length,E=j[b];m=!0,p.forEach(o=>o.classList.add("pinned")),p.forEach(o=>o.style.filter=`hue-rotate(${E}deg)`),s.num_pinned++}x()})}),s.a.name==="case-study-calendar"&&((y=d.find(u=>u.innerText==="time"))==null||y.click(),(w=d.find(u=>u.innerText==="events"))==null||w.click()),s.a.name==="case-study-figma"&&((L=d.find(u=>u.innerText==="prototype-links"))==null||L.click(),($=d.find(u=>u.innerText.includes("prototype-window")))==null||$.click()),s.a.name==="case-study-cad"&&((l=d.find(u=>u.innerText.includes("tabs-view")))==null||l.click(),(v=d.find(u=>u.innerText==="files.active/view"))==null||v.click()),s.a.name==="case-study-slides"&&((h=d.find(u=>u.innerText.includes("list-slides-view")))==null||h.click(),(S=d.find(u=>u.innerText.includes("edit-view")))==null||S.click())}function ne(e){const t={frag:f(".cost-matrix"),analogies:e};return ae(t),t}function ae(e){const t=e.analogies,a=[...new Set(t.flatMap(i=>i.inputs))];e.frag.innerHTML="";const n=a.map((i,c)=>f({class:"cost-matrix-row",style:{}},[...a.map((s,r)=>{const g=[...r===0?[f(".cost-matrix-row-label",A(i))]:[],...c===0?[f(".cost-matrix-col-label",A(s))]:[]],d=t.find(w=>w.inputs[0]===i&&w.inputs[1]===s||w.inputs[1]===i&&w.inputs[0]===s),m=d==null?void 0:d.score;let p="none";const x=["cost-matrix-item"];d!==void 0&&d.num_iterations<=3&&x.push("insignificant"),m!==void 0&&(p=`oklab(${.5} ${.1} ${-.2} / ${m*.9})`);const y=`${m!==void 0?m:"-"} (${i}, ${s})`;return f({class:x,title:y,style:{background:p},data:[["name",T(i,s)],["alt_name",T(s,i)]]},g)})]));e.frag.append(...n)}let N=document.querySelector(".loading");async function re(){const e=await(await fetch("./specs.json")).json(),t=await(await fetch("./case-study-specs.json")).json(),a=await(await fetch("./analogies.json")).json(),n=await(await fetch("./case-study-analogies.json")).json(),i=l=>({name:l,yaml:e[l].yaml,lookup:e[l].lookup}),c=l=>({name:l,yaml:t[l].yaml,lookup:t[l].lookup});let s=[];for(const l of a){const v=await K(i(l.inputs[0]),i(l.inputs[1]),a.find(h=>h.inputs.includes(l.inputs[0])&&h.inputs.includes(l.inputs[1])));s.push(v)}const r=await Promise.all(n.map(l=>K(c(l.inputs[0]),c(l.inputs[1]),n.find(v=>v.inputs.includes(l.inputs[0])&&v.inputs.includes(l.inputs[1]))))),g=ne(a),d=s.map(l=>[T(l.a.name,l.b.name),l.frag]),m=r.map(l=>[f(".case-study-tab-label",T(l.a.name,l.b.name)),l.frag]),p=G(".app-tabs",[...m,...d]),x=[...p.querySelectorAll(".tabs-toggles > *")],y=[...p.querySelectorAll(".tabs-toggles > *.case-study-tab-label")],w=[...g.frag.querySelectorAll(".cost-matrix-item")],L=[...g.frag.querySelectorAll(".cost-matrix-row-label"),...g.frag.querySelectorAll(".cost-matrix-col-label")];y[0].innerText="Section 5.2: "+y[0].innerText,y[1].innerText="Section 5.3: "+y[1].innerText,y[2].innerText="Section 5.4: "+y[2].innerText,y[3].innerText="Section 5.4: "+y[3].innerText,w.forEach(l=>{const v=x.findIndex(h=>h.innerText===l.dataset.name||h.innerText===l.dataset.alt_name);v!==-1&&l.addEventListener("click",()=>{p.dispatchEvent(new CustomEvent("switch-tab",{detail:v})),w.forEach(h=>h.classList.remove("active")),L.forEach(h=>h.classList.remove("active")),L.filter(h=>h.innerText===l.dataset.name.split(" / ")[0]||h.innerText===l.dataset.name.split(" / ")[1]).forEach(h=>{h.classList.add("active")}),w.filter(h=>h.dataset.name===l.dataset.name||h.dataset.alt_name===l.dataset.name).forEach(h=>h.classList.add("active"))})}),y.forEach(l=>{l.addEventListener("click",()=>{w.forEach(v=>v.classList.remove("active")),L.forEach(v=>v.classList.remove("active"))})});const $=f(".case-study-label-container",y);p.children[0].prepend($),document.getElementById("app").append(p),p.children[0].append(g.frag),p.children[0].prepend(f(".section-label","Case studies")),p.children[0].insertBefore(f(".section-label","Computed analogies"),p.children[0].children[5]),N==null||N.remove()}re();
