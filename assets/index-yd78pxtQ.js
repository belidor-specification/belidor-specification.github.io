(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();function B(e,t={},a=[]){if(typeof t=="string"&&(t.at(0)==="."?e.classList.add(t.slice(1)):t.at(0)==="#"?e.id=t.slice(1):console.trace("[el] Props is a string but not qualified with a class (.) or id (#).")),typeof t!="string"&&(Object.assign(e,t??{}),"class"in t&&t.class!==void 0&&e.classList.add(...Array.isArray(t.class)?t.class.filter(n=>n!==null):[t.class]),"data"in t&&t.data!==void 0&&t.data.forEach(n=>e.dataset[n[0]]=n[1]),"style"in t&&t.style!==void 0))for(const[n,i]of Object.entries(t.style))e.style[n]=`${i}`;a!==void 0&&e.append(...Array.isArray(a)?a:[a])}function N(e,t={},a=[]){const n=document.createElement(e);return B(n,t,a),n}function I(e,t={},a=[]){const n=document.createElementNS("http://www.w3.org/2000/svg",e);return B(n,t,a),n}function d(e={},t=[]){return N("div",e,t)}function P(e={},t=""){const a=I("path",e);return a.setAttribute("d",t),a}function q(e,t){if(!e)throw new Error("Assertion failed")}function H(e,t,a,n){e.y+=e.height/2-1,e.height=1*2,t.y+=t.height/2-1,t.height=1*2,e.x+=a,t.x+=n;const i=[e.x+e.width,e.y],c=[(e.x+e.width+t.x)/2,e.y],r=[(e.x+e.width+t.x)/2,t.y],o=[t.x,t.y];let h=`M ${i[0]-a} ${i[1]+e.height/2} L ${i[0]} ${i[1]} C ${c[0]} 
${c[1]}, ${r[0]} ${r[1]}, ${o[0]} ${o[1]} L ${o[0]-n} ${o[1]+t.height/2}`;return h+=`L ${o[0]-n} ${o[1]+t.height/2} L ${o[0]} ${o[1]+t.height} C ${r[0]} ${r[1]+t.height}, 
  ${c[0]} ${c[1]+e.height}, ${i[0]} ${i[1]+e.height}
  L ${i[0]-a} ${i[1]+e.height/2}`,h}function O(e){return e.replaceAll("->","__A__").replaceAll(".","__D__").replaceAll("/","__S__").replaceAll("=","__E__")}function F(){return Math.round(Math.random()*1e6).toString()}function A(e){let t=e.split("-").map(a=>a[0].toUpperCase()+a.slice(1)).join(" ");return t.startsWith("Case Study")&&(t=t.slice(11)),t==="Slides Figma"&&(t="Slides"),t==="Cad"&&(t="CAD"),t==="Ipad"&&(t="iPad"),t==="Imessage"&&(t="iMessage"),t}function T(e,t){return`${A(e)} / ${A(t)}`}function K(e,t,a=0){const n=t.map((o,h)=>typeof o[0]=="string"?d({onclick:()=>c(h)},o[0]):(o[0].onclick=()=>c(h),o[0])),i=d(".tabs-toggles",n),c=o=>{const h=[...n];t[o][1].classList.add("active"),t.filter((f,m)=>m!==o).forEach(f=>f[1].classList.remove("active")),h[o].classList.add("active"),h.filter((f,m)=>m!==o).forEach(f=>f.classList.remove("active"))};c(a);const r=d(e,[i,d(".tabs-panes",t.map(o=>o[1]))]);return r.classList.add("tabs"),r.addEventListener("switch-tab",o=>{q("detail"in o),c(o.detail)}),r}function Y(e,t,a=0,n=""){const i=K(e,t,a);return i.classList.add("vtabs"),n.length>0&&i.children[0].prepend(d(".vtabs-header",n)),i}function R(e,t,a,n=0){const i=[];for(let r=0;r<a.length-1;r++)i.push(a[r]);a.length>0&&i.push(a.at(-1));const c=d(t,i);return c.classList.add("stack",e==="horizontal"?"hstack":"vstack"),c.style.gap=`${n}px`,c}function G(e,t,a=0){return R("horizontal",e,t,a)}function D(e,t,a=0){return R("vertical",e,t,a)}async function J(e){const t={frag:d(".viewer"),spec:e,view:void 0};return await C(t),t}async function C(e){e.frag.innerHTML="",e.view=M(e.spec.yaml,[]);const t=await Q(e);e.frag.append(t),e.frag.append(d(".viewer-yaml",e.view.frag))}async function Q(e){const t=await(await fetch(`./annotations/${e.spec.name}.svg`)).text(),a=d({class:"viewer-ui",innerHTML:t}),n=a.children[0];if(n.setAttribute("preserveAspectRatio","xMinYMin meet"),n.removeAttribute("width"),n.removeAttribute("height"),n.children.length>0){[...n.children[0].children].forEach(r=>{typeof r.id=="string"&&(r.id=O(r.id))});const i=F();[...n.querySelectorAll("pattern"),...n.querySelectorAll("filter"),...n.querySelectorAll("linearGradient")].forEach(r=>r.id=`${r.id}_ID${i}`);const c=[...n.querySelectorAll("rect"),...n.querySelectorAll("path"),...n.querySelectorAll("g")];["fill","stroke","filter"].forEach(r=>{c.forEach(o=>{const h=o.getAttribute(r);h!==null&&h.startsWith("url(#")&&o.setAttribute(r,`url(#${h.slice(5,-1)}_ID${i})`)})})}return a}function M(e,t){if(typeof e=="object"&&!Array.isArray(e))return V(e,t);if(typeof e=="object"&&Array.isArray(e))return X(e,t);if(typeof e=="string")return U(e,t);throw new Error("[render] Unknown object typ")}function V(e,t){const a=Object.keys(e).map(i=>U(i,[...t,["__KEY",i]],!0)),n=Object.entries(e).map(([i,c])=>M(c,[...t,i]));return{type:"Object",frag:D(".v-obj",Object.entries(e).map((i,c)=>{const r=["v-obj-entry"];return n[c].type==="Primitive"&&r.push("is-single-line"),d({class:r},[d(".v-obj-key",a[c].frag),d(".v-obj-value",n[c].frag)])})),path:t,keys:a,values:n}}function X(e,t){let a=["v-array"];e.length===3&&["subset>","cover>","affects>"].includes(e[1])&&a.push("v-relation-array");const n=e.map((i,c)=>M(i,[...t,c]));return{type:"Array",frag:D({class:a},e.map((i,c)=>d(".v-array-entry",n[c].frag))),path:t,items:n}}function U(e,t,a=!1){let n;const i=["v-string"];if(a&&i.push("v-key"),["affects","cover","cover>","group","subset","subset>","<>","create","delete","update","directions","group foreach"].includes(e)&&(i.push("v-relation"),e.at(-1)!==">"&&(e+=">")),e.startsWith("(")){const c=e.indexOf(")",1),r=e.slice(0,c+1),o=e.slice(c+1);n=d({class:i},[d(".v-string-type",r),o])}else n=d({class:i},e);return{type:"Primitive",frag:n,path:t,value:e}}function k(e,t){if(t(e))return e;if(e.type==="Array")for(const a of e.items){const n=k(a,t);if(n!==void 0)return n}if(e.type==="Object"){for(const a of e.keys){const n=k(a,t);if(n!==void 0)return n}for(const a of e.values){const n=k(a,t);if(n!==void 0)return n}}}async function W(e,t,a){const n=await J(e),i=await J(t),c={frag:G(".analogy-viewer",[d(".header-preamble",[N("h1",{},"Structural Analogies of User Interfaces with Belidor"),d({innerHTML:`Belidor is a specification language for describing user interfaces and help surface analogies between them. Below are interactive displays of various analogies described in the paper.
        <br><br>
        Instructions:
        <ol>
          <li>Hover over an identifier in a specification to highlight the match across both interfaces.</li>
          <li>Click on an identifier in the specification to pin it.</li>
          <li>Navigate between case studies using the navigation list on the left. Navigate between computed analogies by clicking on a cell in the heat map.</li>
        </ol>`})]),d(".analogy-title",[d({},A(e.name)),d(".ampersand","&"),d({},A(t.name))]),d(".analogy-viewer-viewers",[n.frag,i.frag,I("svg",".overlay")])]),a:e,b:t,a_viewer:n,b_viewer:i,analogy:a,num_pinned:0,num_highlighted:0};return await Z(c,e,t),c}async function Z(e,t,a){const{a_viewer:n,b_viewer:i}=e;e.a=t,e.b=a,n.spec=t,i.spec=a,await C(n),await C(i),setTimeout(()=>ee(e),1e3)}function ee(e){const{a:t,b:a,a_viewer:n,b_viewer:i,analogy:c}=e,r=e.frag.querySelector(".overlay");r.innerHTML="";const o=e.frag.getBoundingClientRect(),h=n.frag.getBoundingClientRect(),f=i.frag.getBoundingClientRect();for(const[m,p]of Object.entries(c.analogy[0])){if(p[1]===!0)continue;const x=p[0],y=t.lookup.filter(s=>s[0]===m).map(s=>s[1]),w=a.lookup.filter(s=>s[0]===x).map(s=>s[1]);q(n.view!==void 0),q(i.view!==void 0);const L=y.map(s=>k(n.view,_=>JSON.stringify(_.path)===JSON.stringify(s))).filter(s=>s!==void 0),$=w.map(s=>k(i.view,_=>JSON.stringify(_.path)===JSON.stringify(s))).filter(s=>s!==void 0),l=n.frag.querySelector(`#${O(m)}`),v=i.frag.querySelector(`#${O(x)}`),g=L.map(s=>s.frag.getBoundingClientRect()).map(s=>(s.x-=o.x,s.y-=o.y,s)),S=$.map(s=>s.frag.getBoundingClientRect()).map(s=>(s.x-=o.x,s.y-=o.y,s)),u={x:(h.right+f.left)/2-o.x,y:g.reduce((s,_)=>s+_.y+_.height/2,0)/g.length,width:1,height:1},b=g.map(s=>P(".connection-path",H(s,u,h.right-s.right-o.x,0))),E=S.map(s=>P(".connection-path",H(u,s,0,f.left-s.left-o.x)));te($,L,E,b,v,l,e),r.append(...b),r.append(...E)}}const j=[0,45,180,-90,135,90];function te(e,t,a,n,i,c,r){var y,w,L,$,l,v,g,S;const o=e.map(u=>u.frag),h=t.map(u=>u.frag),f=[...o,...h];f.forEach(u=>u.classList.add("matched"));let m=!1,p=[...f,...a,...n,i,c].filter(u=>u!==null),x=()=>{r.num_highlighted>0||r.num_pinned>0?r.frag.classList.add("focused"):r.frag.classList.remove("focused")};f.forEach(u=>{u.addEventListener("mouseenter",()=>{if(p.some(s=>s.classList.contains("pinned")))return;p.forEach(s=>s.classList.add("highlight"));const b=r.num_pinned%j.length,E=j[b];p.forEach(s=>s.style.filter=`hue-rotate(${E}deg)`),r.num_highlighted++,x()}),u.addEventListener("mouseleave",()=>{p.some(b=>b.classList.contains("pinned"))||(p.forEach(b=>b.classList.remove("highlight")),p.forEach(b=>b.style.filter=""),r.num_highlighted--,x())}),u.addEventListener("click",()=>{if(m)m=!1,p.forEach(b=>b.classList.remove("pinned")),p.forEach(b=>b.style.filter=""),r.num_pinned--;else{const b=r.num_pinned%j.length,E=j[b];m=!0,p.forEach(s=>s.classList.add("pinned")),p.forEach(s=>s.style.filter=`hue-rotate(${E}deg)`),r.num_pinned++}x()})}),r.a.name==="case-study-calendar"&&((y=f.find(u=>u.innerText==="time"))==null||y.click(),(w=f.find(u=>u.innerText==="events"))==null||w.click()),r.a.name==="case-study-figma"&&((L=f.find(u=>u.innerText==="prototype-links"))==null||L.click(),($=f.find(u=>u.innerText.includes("prototype-window")))==null||$.click()),r.a.name==="case-study-cad"&&((l=f.find(u=>u.innerText.includes("tabs-view")))==null||l.click(),(v=f.find(u=>u.innerText==="files.active/view"))==null||v.click()),r.a.name==="case-study-slides"&&((g=f.find(u=>u.innerText.includes("list-slides-view")))==null||g.click(),(S=f.find(u=>u.innerText.includes("edit-view")))==null||S.click())}function ne(e){const t={frag:d(".cost-matrix"),analogies:e};return ie(t),t}function ie(e){const t=e.analogies,a=[...new Set(t.flatMap(i=>i.inputs))];e.frag.innerHTML="";const n=a.map((i,c)=>d({class:"cost-matrix-row",style:{}},[...a.map((r,o)=>{const h=[...o===0?[d(".cost-matrix-row-label",A(i))]:[],...c===0?[d(".cost-matrix-col-label",A(r))]:[]],f=t.find(w=>w.inputs[0]===i&&w.inputs[1]===r||w.inputs[1]===i&&w.inputs[0]===r),m=f==null?void 0:f.score;let p="none";const x=["cost-matrix-item"];f!==void 0&&f.num_iterations<=3&&x.push("insignificant"),m!==void 0&&(p=`oklab(${.5} ${.1} ${-.2} / ${m*.9})`);const y=`${m!==void 0?m:"-"} (${i}, ${r})`;return d({class:x,title:y,style:{background:p},data:[["name",T(i,r)],["alt_name",T(r,i)]]},h)})]));e.frag.append(...n)}async function ae(){const e=await(await fetch("./specs.json")).json(),t=await(await fetch("./case-study-specs.json")).json(),a=await(await fetch("./analogies.json")).json(),n=await(await fetch("./case-study-analogies.json")).json(),i=l=>({name:l,yaml:e[l].yaml,lookup:e[l].lookup}),c=l=>({name:l,yaml:t[l].yaml,lookup:t[l].lookup}),r=await Promise.all(a.map(l=>W(i(l.inputs[0]),i(l.inputs[1]),a.find(v=>v.inputs.includes(l.inputs[0])&&v.inputs.includes(l.inputs[1]))))),o=await Promise.all(n.map(l=>W(c(l.inputs[0]),c(l.inputs[1]),n.find(v=>v.inputs.includes(l.inputs[0])&&v.inputs.includes(l.inputs[1]))))),h=ne(a),f=r.map(l=>[T(l.a.name,l.b.name),l.frag]),m=o.map(l=>[d(".case-study-tab-label",T(l.a.name,l.b.name)),l.frag]),p=Y(".app-tabs",[...m,...f]),x=[...p.querySelectorAll(".tabs-toggles > *:not(.cost-matrix):not(.case-study-label-container):not(.section-label)")],y=[...p.querySelectorAll(".tabs-toggles > *.case-study-tab-label")],w=[...h.frag.querySelectorAll(".cost-matrix-item")],L=[...h.frag.querySelectorAll(".cost-matrix-row-label"),...h.frag.querySelectorAll(".cost-matrix-col-label")];w.forEach(l=>{const v=x.findIndex(g=>g.innerText===l.dataset.name||g.innerText===l.dataset.alt_name);v!==-1&&l.addEventListener("click",()=>{p.dispatchEvent(new CustomEvent("switch-tab",{detail:v})),w.forEach(g=>g.classList.remove("active")),L.forEach(g=>g.classList.remove("active")),L.filter(g=>g.innerText===l.dataset.name.split(" / ")[0]||g.innerText===l.dataset.name.split(" / ")[1]).forEach(g=>{g.classList.add("active")}),w.filter(g=>g.dataset.name===l.dataset.name||g.dataset.alt_name===l.dataset.name).forEach(g=>g.classList.add("active"))})}),y.forEach(l=>{l.addEventListener("click",()=>{w.forEach(v=>v.classList.remove("active")),L.forEach(v=>v.classList.remove("active"))})});const $=d(".case-study-label-container",y);p.children[0].prepend($),y[0].innerText="Section 5.2: "+y[0].innerText,y[1].innerText="Section 5.3: "+y[1].innerText,y[2].innerText="Section 5.4: "+y[2].innerText,y[3].innerText="Section 5.4: "+y[3].innerText,document.getElementById("app").append(p),p.children[0].append(h.frag),p.children[0].prepend(d(".section-label","Case studies")),p.children[0].insertBefore(d(".section-label","Computed analogies"),p.children[0].children[5])}async function z(){requestAnimationFrame(z)}ae(),z();
